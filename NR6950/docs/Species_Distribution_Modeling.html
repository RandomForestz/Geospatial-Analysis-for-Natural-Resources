<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Josh Carrell - Utah State University, MS Ecology" />


<title>Species Distribution Modeling: Lecture &amp; Coding Guide</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NR 6950: Geospatial Analysis for Natural Resources</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Introduction_to_R_Programming.html">Intro to R</a>
    </li>
    <li>
      <a href="Introduction_to_Data_Wrangling.html">Intro to Data Wrangling</a>
    </li>
    <li>
      <a href="Introduction_to_Data_Visualization.html">Intro to Data Visualization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Geospatial Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Introduction_to_Geospatial_Data_Coordinate_Systems.html">Introduction to Coordinate Systems</a>
    </li>
    <li>
      <a href="Introduction_to_Spatial_Vector_Data.html">Introduction to Spatial Vector Data</a>
    </li>
    <li>
      <a href="Introduction_to_Spatial_Raster_Data.html">Introduction to Spatial Raster Data</a>
    </li>
    <li>
      <a href="Introduction_to_Remote_Sensing.html">Introduction to Remote Sensing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced Geospatial Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Point_Pattern_Analysis.html">Point Pattern Analysis</a>
    </li>
    <li>
      <a href="Burn_ratio.html">Remote Sensing: Difference Normalized Burn Ratio</a>
    </li>
    <li>
      <a href="Species_Distribution_Modeling.html">Species Distribution Modeling</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Species Distribution Modeling: Lecture &amp; Coding Guide</h1>
<h4 class="author">Josh Carrell - Utah State University, MS Ecology</h4>
<h4 class="date">Last Update: May 13, 2022</h4>

</div>


<div id="species-distribution-modeling" class="section level2">
<h2>Species Distribution Modeling</h2>
<p>Species Distribution Modeling (SDM) is a dense topic. There are so many different algorithms to use and methods for model preparation. You can spend an entire career researching SDM, and many do. Here, we’ll cover SDM flying high at 30,000 feet.</p>
<p>You’ll be able to define SDM, understand it’s importance in ecological and social studies, and be able to create a Generalized Linear Model from this tutorial.</p>
<hr />
<p>SDM is the process of using species occurrence data (the observed x,y location of an organism) and predictor variables (climate, soils, topography) to predict the spatial distribution of a given species.</p>
<p><img src="D:/R%20Textbook%20Template/NR6950%20Notebook/NR%206950%20Notebook/images/sdm.png" /></p>
<p>Also known as Ecological Niche Modeling, Habitat Suitability Modeling, and range mapping, SDM is a common tool used in conservation biology and bioregional planning.</p>
<hr />
<div id="sdm-specifics" class="section level3">
<h3>SDM Specifics</h3>
<p>SDM does not provide information on how many species are present in a location (abundance) or if a species is actually even there. SDM outputs are probability representations of habitat that is suitable for a given species.</p>
<p>SDM is a modeling effort to define suitable habitat. The goal of a model is to represent reality. However, all models are inherently “wrong”. They can be useful and be powerful tools in ecology, but it is important to understand SDM has limitations.</p>
<hr />
</div>
</div>
<div id="generalized-linear-model" class="section level2">
<h2>Generalized Linear Model</h2>
<p>GLM “…can be applied in univariate and multivariate applications, and it is used to estimate an ecological response as a linear combination of independent predictor variables.”</p>
<p><img src="D:/R%20Textbook%20Template/NR6950%20Notebook/NR%206950%20Notebook/images/glm.jpg" /></p>
</div>
<div id="model-requirements" class="section level2">
<h2>Model Requirements</h2>
<p>SDM require predictor variables (x) and a response variable (y).</p>
<hr />
<div id="predictor-variables" class="section level3">
<h3>Predictor Variables</h3>
<p>Predictor variables are our explanatory variables. Based on occurrence location (the response variable) the predictor variables help explain and produce a predicted distribution of the species of interest.</p>
<p>For example, let’s say there is a very green plant species that occurs on northern slopes, steep slopes, and at elevations higher than 500m.</p>
<div class="figure">
<img src="D:/R%20Textbook%20Template/NR6950%20Notebook/NR%206950%20Notebook/images/suitability.png" alt="" />
<p class="caption">Yes, this is a poorly drawn figure in microsoft paint</p>
</div>
<p>By using variables in elevation (occurs only above 500m) slope (occurs only on steep slopes) and aspect (occurs only on northern facing slopes) we can get a good idea of where that plant species will occur. However, an algorithm like GLM allows us to include many variables and examine their influence on habitat suitability computationally.</p>
</div>
<div id="response-variable-species-occurrence" class="section level3">
<h3>Response Variable (Species Occurrence)</h3>
<p>The response variables guides the selection of variable importance in the distribution of a given species. By spatially overlaying the occurrence points of a species on the predictor variables, we can see which values are associated with each occurrence point.</p>
<hr />
</div>
</div>
<div id="modeling" class="section level2">
<h2>Modeling</h2>
<div id="blue-spruce---picea-pungens" class="section level3">
<h3>Blue Spruce - <em>Picea pungens</em></h3>
<p>Our species of interest for this SDM example will be the state tree of Colorado, the Blue Spruce. Blue spruce is from the spruce family (Picea) and it’s genus (pungens) is latin for “sharp”, “biting, or”piercing”. If you’ve ever come in contact with a blue spruce, you can understand why it would be named <em>pungens</em>. Very sharp needles.</p>
<p>Blue spruce is generally green.. but can look very blue due to a wax that reflects blue light on it’s needles. Blue spruce can be found in the Southern Rockies at 6,000-10,000 feet but is also a commonly planted tree in yards and cities. For example, I have a small blue spruce in my front yard at ~4,600 feet. Seems to be doing just fine..</p>
<p>They also make an excellent Christmas tree.</p>
<p><img src="D:/R%20Textbook%20Template/NR6950%20Notebook/NR%206950%20Notebook/images/blue.jpg" /></p>
<hr />
</div>
<div id="gathering-species-data-via-spocc" class="section level3">
<h3>Gathering Species Data via Spocc</h3>
<p>The spocc library is a “programmatic interface to many species occurrence data sources, including GBIF, USGS’s BISON, iNaturalist, Berkeley Ecoinformatics Engine, eBird, iDigBio, VertNet, OBIS, and ALA. Includes functionality for retrieving species occurrence data, and combining that data.”</p>
</div>
<div id="occ" class="section level3">
<h3>occ()</h3>
<p>The occ() function is where we do all of our species occurrence data gathering.</p>
<p>First up, let’s load the spocc package (install it if this is your first time!) and the sf package as well.</p>
<pre class="r"><code># Load libraries
library(spocc) # data gathering
library(sf)
library(dplyr)
library(PresenceAbsence)
library(DAAG)
library(raster)</code></pre>
<hr />
<p>The first thing the occ() function requires is the binomial nomenclature for the species of interest (Genus species). I tend to place the names within another variable called spp.listA (species list name).</p>
<p>For this tutorial, we will be building models for the state tree of Colorado, the Blue Spruce (<em>Picea pungens</em>).</p>
<p>Assign a variable of your choice to <strong>c(“Picea pungens”)</strong></p>
<pre class="r"><code>spp.listA = c(&quot;Picea pungens&quot;) # replace Genus species</code></pre>
<hr />
<p>Let’s now use the occ() function query our newly assigned variable by using <strong>“query = variable”</strong>.</p>
<p>We will also include all the databases that may contain occurrence data for the blue spruce be using <strong>from = c(“all the databases”)</strong>. I’ve included all the databases in the code below.</p>
<p>Lastly, let’s include a max limit on how many occurrences from each database we would like and make sure they have x,y coordinates assigned to them by using:</p>
<p><strong>limit = #, has_coords = T</strong>.</p>
<p>Let’s set a limit at 20,000.</p>
<hr />
<p>Let’s give it a shot below (This may take a while!):</p>
<pre class="r"><code>#spp.occ &lt;- occ(query = spp.listA, 
#               from = c(&quot;gbif&quot;, &quot;inat&quot;, &quot;ecoengine&quot;, &quot;vertnet&quot;, 
#                        &quot;bison&quot;, &quot;ala&quot;, &quot;idigbio&quot;, &quot;obis&quot;), # This will search #occurrences in these databases
#               limit = 20000, has_coords = T) # Requiring data has coordinates</code></pre>
<pre class="r"><code>#spp.occRAW &lt;- data.frame(occ2df(spp.occ))  # coerce to dataframe

#pander::pander(head(spp.occRAW, 5)) 

#dim(spp.occRAW)

#pander::pander(table(spp.occRAW$prov)) # examine



# save raw csv
#write.csv(spp.occRAW, file = &quot;D:/NR_6950/data/sdm_PIPU/spp.occRAW.csv&quot;)</code></pre>
<pre class="r"><code>pipu.occRAW &lt;- read.csv(&quot;D:/R Textbook Template/NR6950 Notebook/NR 6950 Notebook/Data/sdm_PIPU/spp.occRAW.csv&quot;)
pander::pander(head(pipu.occRAW, 5))</code></pre>
<table>
<colgroup>
<col width="4%" />
<col width="28%" />
<col width="14%" />
<col width="13%" />
<col width="8%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">X</th>
<th align="center">name</th>
<th align="center">longitude</th>
<th align="center">latitude</th>
<th align="center">prov</th>
<th align="center">date</th>
<th align="center">key</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">Picea pungens Engelm.</td>
<td align="center">10.13</td>
<td align="center">48.73</td>
<td align="center">gbif</td>
<td align="center">2022-01-01</td>
<td align="center">3447324677</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Picea pungens Engelm.</td>
<td align="center">10.29</td>
<td align="center">48.87</td>
<td align="center">gbif</td>
<td align="center">2022-01-02</td>
<td align="center">3447350370</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">Picea pungens Engelm.</td>
<td align="center">10.29</td>
<td align="center">48.88</td>
<td align="center">gbif</td>
<td align="center">2022-01-05</td>
<td align="center">3447362029</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">Picea pungens Engelm.</td>
<td align="center">10.29</td>
<td align="center">48.87</td>
<td align="center">gbif</td>
<td align="center">2022-01-02</td>
<td align="center">3447371607</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">Picea pungens Engelm.</td>
<td align="center">10.13</td>
<td align="center">48.73</td>
<td align="center">gbif</td>
<td align="center">2022-01-01</td>
<td align="center">3447384677</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
<div id="predictors" class="section level2">
<h2>Predictors</h2>
<p>Now that we have our species occurrence data (which still needs some further manipulation.. save that for later) let’s load our predictor variables using the terra package.</p>
<pre class="r"><code>preds &lt;- terra::rast(&quot;D:/R Textbook Template/NR6950 Notebook/NR 6950 Notebook/Data/preds/predictors.tif&quot;)
names(preds)</code></pre>
<pre><code>##  [1] &quot;elevation&quot;  &quot;slope&quot;      &quot;aspect&quot;     &quot;phmin&quot;      &quot;phave&quot;     
##  [6] &quot;phmax&quot;      &quot;frag3to10&quot;  &quot;sieveno4&quot;   &quot;sieveno10&quot;  &quot;sieveno40&quot; 
## [11] &quot;sieveno200&quot; &quot;omr&quot;        &quot;dryweight&quot;  &quot;ksat&quot;       &quot;awc&quot;       
## [16] &quot;wsat&quot;       &quot;sand&quot;       &quot;silt&quot;       &quot;clay&quot;       &quot;Bio1&quot;      
## [21] &quot;Bio10&quot;      &quot;Bio11&quot;      &quot;Bio12&quot;      &quot;Bio13&quot;      &quot;Bio14&quot;     
## [26] &quot;Bio15&quot;      &quot;Bio16&quot;      &quot;Bio17&quot;      &quot;Bio18&quot;      &quot;Bio19&quot;     
## [31] &quot;Bio2&quot;       &quot;Bio3&quot;       &quot;Bio4&quot;       &quot;Bio5&quot;       &quot;Bio6&quot;      
## [36] &quot;Bio7&quot;       &quot;Bio8&quot;       &quot;Bio9&quot;</code></pre>
<pre class="r"><code>terra::plot(preds)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>terra::plot(preds$elevation, main = &quot;1km Elevation of Colorado&quot;)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="species-occurrence-organization" class="section level2">
<h2>Species Occurrence Organization</h2>
<p>Let;s organize our presence points and develop a few maps along the way.</p>
<pre class="r"><code># Load species raw data
spec.raw &lt;- pipu.occRAW %&gt;%                        # Load csv
  na.omit(spec.raw) %&gt;%                                           # omit NA values
  st_as_sf(., coords = c(&quot;longitude&quot;,&quot;latitude&quot;), crs = 4326)</code></pre>
<div id="colorado" class="section level3">
<h3>Colorado</h3>
<pre class="r"><code>states &lt;- sf::st_read(&quot;D:/R Textbook Template/NR6950 Notebook/NR 6950 Notebook/Data/sf_datasets/state.shp&quot;)</code></pre>
<pre><code>## Reading layer `state&#39; from data source 
##   `D:\R Textbook Template\NR6950 Notebook\NR 6950 Notebook\Data\sf_datasets\state.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 56 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -179.1686 ymin: -14.59976 xmax: 179.7487 ymax: 71.38961
## Geodetic CRS:  WGS 84</code></pre>
<pre class="r"><code>Colorado &lt;- states %&gt;% 
  filter(STATE == &quot;Colorado&quot;)</code></pre>
</div>
<div id="species-occurrences-in-colorado" class="section level3">
<h3>Species occurrences in Colorado</h3>
<pre class="r"><code>pipu &lt;- spec.raw
pipu &lt;- sf::st_crop(pipu, Colorado)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<pre class="r"><code>plot(Colorado$geometry)
plot(pipu$geometry, add = T)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-10-1.png" width="672" /> ### Pseudo-absences</p>
<p>SDM often requires the use of species absence points. Just as presence points tell us which values for each predictor variable are useful in modeling a species distribution, absence tells us which values are not important. The use of absence allows us to define the overall habitat suitability of a species.</p>
<p>This is a process known as an x-fold pseudo-absence process. Since we do not have field collected absence points, we generate random points across our modeling domain (the state of colorado). Since these points are random, we are “oversampling”. Meaning, we are doubling the amount of presence points for our absence points due to the off chance that an absence point is a presence point in reality.</p>
<pre class="r"><code>set.seed(1111) # change this value for each species!!!!!!!!!
pipu.abs &lt;- st_sample(st_geometry(Colorado), type = &quot;random&quot;, size = (nrow(pipu)*2)) %&gt;% 
  st_sf() 
plot(Colorado$geometry)
plot(pipu.abs$geometry, add = T, col = &quot;blue&quot;) # plot abs in blue inside buffer
plot(pipu$geometry, add = T, col = &quot;red&quot;) # pres on top in red</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-11-1.png" width="672" /> ### Combining Presence and Absence</p>
<pre class="r"><code>abs.coords &lt;- st_coordinates(pipu.abs) # coords of absence points
pipu.abs &lt;- cbind(abs.coords, pipu.abs) # bind coords and geometry
pipu.abs$PA &lt;- 0 # add absence 0 in PA column
pipu.abs &lt;- pipu.abs[c(1:2, 4, 3)] # organize columns</code></pre>
<pre class="r"><code>pres.coords &lt;- sf::st_coordinates(pipu)
head(pres.coords)</code></pre>
<pre><code>##           X        Y
## 1 -106.0545 39.47771
## 2 -106.0581 39.47640
## 3 -106.0524 39.47422
## 4 -106.0528 39.47422
## 5 -106.0495 39.47648
## 6 -105.5342 39.96373</code></pre>
<pre class="r"><code>head(pipu)</code></pre>
<pre><code>## Simple feature collection with 6 features and 5 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -106.0581 ymin: 39.47422 xmax: -105.5342 ymax: 39.96373
## Geodetic CRS:  WGS 84
##     X                  name prov       date        key
## 11 11 Picea pungens Engelm. gbif 2022-01-07 3456150413
## 16 16 Picea pungens Engelm. gbif 2022-01-07 3456561365
## 17 17 Picea pungens Engelm. gbif 2022-01-07 3456585418
## 20 20 Picea pungens Engelm. gbif 2022-01-07 3456899462
## 21 21 Picea pungens Engelm. gbif 2022-01-06 3456992087
## 25 25 Picea pungens Engelm. gbif 2022-01-18 3465993095
##                      geometry
## 11 POINT (-106.0545 39.47771)
## 16  POINT (-106.0581 39.4764)
## 17 POINT (-106.0524 39.47422)
## 20 POINT (-106.0528 39.47422)
## 21 POINT (-106.0495 39.47648)
## 25 POINT (-105.5342 39.96373)</code></pre>
<pre class="r"><code>pipu &lt;- cbind(pres.coords, pipu)</code></pre>
<pre class="r"><code>head(pipu, 5)</code></pre>
<pre><code>## Simple feature collection with 5 features and 7 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -106.0581 ymin: 39.47422 xmax: -106.0495 ymax: 39.4777
## Geodetic CRS:  WGS 84
##           X        Y X.1                  name prov       date        key
## 1 -106.0545 39.47771  11 Picea pungens Engelm. gbif 2022-01-07 3456150413
## 2 -106.0581 39.47640  16 Picea pungens Engelm. gbif 2022-01-07 3456561365
## 3 -106.0524 39.47422  17 Picea pungens Engelm. gbif 2022-01-07 3456585418
## 4 -106.0528 39.47422  20 Picea pungens Engelm. gbif 2022-01-07 3456899462
## 5 -106.0495 39.47648  21 Picea pungens Engelm. gbif 2022-01-06 3456992087
##                     geometry
## 1 POINT (-106.0545 39.47771)
## 2  POINT (-106.0581 39.4764)
## 3 POINT (-106.0524 39.47422)
## 4 POINT (-106.0528 39.47422)
## 5 POINT (-106.0495 39.47648)</code></pre>
<pre class="r"><code>head(pipu.abs, 5)</code></pre>
<pre><code>## Simple feature collection with 5 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -108.098 ymin: 37.73881 xmax: -102.6943 ymax: 39.09009
## Geodetic CRS:  WGS 84
##           X        Y PA                   geometry
## 1 -105.7930 38.76351  0  POINT (-105.793 38.76351)
## 2 -106.1621 38.66006  0 POINT (-106.1621 38.66006)
## 3 -102.6943 38.86826  0 POINT (-102.6943 38.86826)
## 4 -108.0980 39.09009  0  POINT (-108.098 39.09009)
## 5 -103.8747 37.73881  0 POINT (-103.8747 37.73881)</code></pre>
<pre class="r"><code>pipu$PA &lt;- 1 # give a 1 for presence
names(pipu)</code></pre>
<pre><code>## [1] &quot;X&quot;        &quot;Y&quot;        &quot;X.1&quot;      &quot;name&quot;     &quot;prov&quot;     &quot;date&quot;     &quot;key&quot;     
## [8] &quot;geometry&quot; &quot;PA&quot;</code></pre>
<pre class="r"><code>pipu &lt;- pipu[c(1:2, 9, 8)]

# combine pres and abs
pipu.PA &lt;- rbind(pipu, pipu.abs) # combine 
table(pipu.PA$PA) # examine PA</code></pre>
<pre><code>## 
##    0    1 
## 5504 2752</code></pre>
<pre class="r"><code>head(pipu.PA, 5) # examine</code></pre>
<pre><code>## Simple feature collection with 5 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -106.0581 ymin: 39.47422 xmax: -106.0495 ymax: 39.4777
## Geodetic CRS:  WGS 84
##           X        Y PA                   geometry
## 1 -106.0545 39.47771  1 POINT (-106.0545 39.47771)
## 2 -106.0581 39.47640  1  POINT (-106.0581 39.4764)
## 3 -106.0524 39.47422  1 POINT (-106.0524 39.47422)
## 4 -106.0528 39.47422  1 POINT (-106.0528 39.47422)
## 5 -106.0495 39.47648  1 POINT (-106.0495 39.47648)</code></pre>
</div>
<div id="train-your-data" class="section level3">
<h3>Train your data</h3>
<p>Data training is needed for predictive modeling. Here we are simply extracting the value of each predictor variable to each species absence and presence point.</p>
<pre class="r"><code>names(preds)</code></pre>
<pre><code>##  [1] &quot;elevation&quot;  &quot;slope&quot;      &quot;aspect&quot;     &quot;phmin&quot;      &quot;phave&quot;     
##  [6] &quot;phmax&quot;      &quot;frag3to10&quot;  &quot;sieveno4&quot;   &quot;sieveno10&quot;  &quot;sieveno40&quot; 
## [11] &quot;sieveno200&quot; &quot;omr&quot;        &quot;dryweight&quot;  &quot;ksat&quot;       &quot;awc&quot;       
## [16] &quot;wsat&quot;       &quot;sand&quot;       &quot;silt&quot;       &quot;clay&quot;       &quot;Bio1&quot;      
## [21] &quot;Bio10&quot;      &quot;Bio11&quot;      &quot;Bio12&quot;      &quot;Bio13&quot;      &quot;Bio14&quot;     
## [26] &quot;Bio15&quot;      &quot;Bio16&quot;      &quot;Bio17&quot;      &quot;Bio18&quot;      &quot;Bio19&quot;     
## [31] &quot;Bio2&quot;       &quot;Bio3&quot;       &quot;Bio4&quot;       &quot;Bio5&quot;       &quot;Bio6&quot;      
## [36] &quot;Bio7&quot;       &quot;Bio8&quot;       &quot;Bio9&quot;</code></pre>
<pre class="r"><code># Load species presence
pipu.PA</code></pre>
<pre><code>## Simple feature collection with 8256 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -109.0497 ymin: 36.9951 xmax: -102.0435 ymax: 41.0007
## Geodetic CRS:  WGS 84
## First 10 features:
##            X        Y PA                   geometry
## 1  -106.0545 39.47771  1 POINT (-106.0545 39.47771)
## 2  -106.0581 39.47640  1  POINT (-106.0581 39.4764)
## 3  -106.0524 39.47422  1 POINT (-106.0524 39.47422)
## 4  -106.0528 39.47422  1 POINT (-106.0528 39.47422)
## 5  -106.0495 39.47648  1 POINT (-106.0495 39.47648)
## 6  -105.5342 39.96373  1 POINT (-105.5342 39.96373)
## 7  -105.3920 39.85861  1  POINT (-105.392 39.85861)
## 8  -105.2246 39.99697  1 POINT (-105.2246 39.99697)
## 9  -106.0409 39.64048  1 POINT (-106.0409 39.64048)
## 10 -105.1235 39.83482  1 POINT (-105.1235 39.83482)</code></pre>
<pre class="r"><code># extract predictors to species presence
#PIAR.pres.fnetSF &lt;- sf::st_crop(PIAR.pres.fnetSF, sky$geometry)
#PIAR.presPA.SF &lt;- sf::st_crop(PIAR.presabs, sky$geometry)
spec.pres.sv &lt;- as(pipu.PA, &quot;SpatVector&quot;) # presence must be spatvector
spec.pres.extract &lt;- terra::extract(preds, spec.pres.sv) # perform extraction of preds to presence

spec.trained.data &lt;- cbind(spec.pres.extract, pipu.PA) # combine true pres, fnetids, and extracted preds
head(spec.trained.data) # check</code></pre>
<pre><code>##   ID elevation    slope   aspect phmin phave phmax frag3to10 sieveno4 sieveno10
## 1  1  3044.223 5.370624 126.7778  &lt;NA&gt;   613   780        21       76        70
## 2  2  3044.223 5.370624 126.7778  &lt;NA&gt;   613   780        21       76        70
## 3  3  3071.927 6.000525 112.4125  &lt;NA&gt;   613   780        21       76        70
## 4  4  3071.927 6.000525 112.4125  &lt;NA&gt;   613   780        21       76        70
## 5  5  3033.152 4.774728 180.4395  &lt;NA&gt;   613   780        21       76        70
## 6  6  2681.013 5.298944 113.5942  &lt;NA&gt;   614   780        20       61        56
##   sieveno40 sieveno200 omr dryweight ksat awc wsat sand silt clay Bio1 Bio10
## 1        52         38 609       152 2822   9   31   53   26   22 0.35 10.25
## 2        52         38 609       152 2822   9   31   53   26   22 0.35 10.25
## 3        52         38 609       152 2822   9   31   53   26   22 0.15 10.15
## 4        52         38 609       152 2822   9   31   53   26   22 0.15 10.15
## 5        52         38 609       152 2822   9   31   53   26   22 0.65 10.55
## 6        38         25  61       135  917  14   39   59   23   18 2.65 12.95
##   Bio11 Bio12 Bio13 Bio14 Bio15 Bio16 Bio17 Bio18 Bio19 Bio2 Bio3  Bio4  Bio5
## 1 -9.05 654.6  81.4  39.1  25.4 214.1 124.0 204.7 124.0 13.1 37.8 759.5 19.05
## 2 -9.05 654.6  81.4  39.1  25.4 214.1 124.0 204.7 124.0 13.1 37.8 759.5 19.05
## 3 -9.25 677.8  84.9  40.2  25.7 222.9 127.8 213.0 127.8 13.1 37.8 761.2 18.95
## 4 -9.25 677.8  84.9  40.2  25.7 222.9 127.8 213.0 127.8 13.1 37.8 761.2 18.95
## 5 -8.75 614.1  76.5  36.4  25.6 200.9 115.7 192.4 115.7 13.1 37.9 758.3 19.25
## 6 -6.85 615.0  75.1  25.3  34.4 207.0  85.6 194.4  85.6 13.1 38.3 775.4 21.55
##     Bio6 Bio7  Bio8  Bio9         X        Y PA                   geometry
## 1 -15.55 34.6  9.95 -9.05 -106.0545 39.47771  1 POINT (-106.0545 39.47771)
## 2 -15.55 34.6  9.95 -9.05 -106.0581 39.47640  1  POINT (-106.0581 39.4764)
## 3 -15.75 34.7  9.75 -9.25 -106.0524 39.47422  1 POINT (-106.0524 39.47422)
## 4 -15.75 34.7  9.75 -9.25 -106.0528 39.47422  1 POINT (-106.0528 39.47422)
## 5 -15.25 34.5 10.15 -8.75 -106.0495 39.47648  1 POINT (-106.0495 39.47648)
## 6 -12.65 34.2  1.25 -6.85 -105.5342 39.96373  1 POINT (-105.5342 39.96373)</code></pre>
<pre class="r"><code>spec.trained.data.max &lt;- na.exclude(spec.trained.data)

# organize
names(spec.trained.data)</code></pre>
<pre><code>##  [1] &quot;ID&quot;         &quot;elevation&quot;  &quot;slope&quot;      &quot;aspect&quot;     &quot;phmin&quot;     
##  [6] &quot;phave&quot;      &quot;phmax&quot;      &quot;frag3to10&quot;  &quot;sieveno4&quot;   &quot;sieveno10&quot; 
## [11] &quot;sieveno40&quot;  &quot;sieveno200&quot; &quot;omr&quot;        &quot;dryweight&quot;  &quot;ksat&quot;      
## [16] &quot;awc&quot;        &quot;wsat&quot;       &quot;sand&quot;       &quot;silt&quot;       &quot;clay&quot;      
## [21] &quot;Bio1&quot;       &quot;Bio10&quot;      &quot;Bio11&quot;      &quot;Bio12&quot;      &quot;Bio13&quot;     
## [26] &quot;Bio14&quot;      &quot;Bio15&quot;      &quot;Bio16&quot;      &quot;Bio17&quot;      &quot;Bio18&quot;     
## [31] &quot;Bio19&quot;      &quot;Bio2&quot;       &quot;Bio3&quot;       &quot;Bio4&quot;       &quot;Bio5&quot;      
## [36] &quot;Bio6&quot;       &quot;Bio7&quot;       &quot;Bio8&quot;       &quot;Bio9&quot;       &quot;X&quot;         
## [41] &quot;Y&quot;          &quot;PA&quot;         &quot;geometry&quot;</code></pre>
<pre class="r"><code>spec.trained.data &lt;- spec.trained.data[c(42, 2:4, 6:39)]</code></pre>
</div>
</div>
<div id="generalized-linear-modeling" class="section level2">
<h2>Generalized Linear Modeling</h2>
<div id="assign-predictors" class="section level3">
<h3>Assign predictors</h3>
<pre class="r"><code># mod.LR pathway
#path.LR &lt;- &quot;F:/Josh/Plants/spp/Mods/Mod.LR&quot;
#setwd(path.LR)

#load(&quot;F:/Josh/Plants/spp/frames/bbox/spp.bbox.RDATA&quot;, verbose = T)

# Load preds
spp.preds &lt;- preds


# load presabs trained data
#load(&quot;F:/Josh/Plants/spp/trained_data/spp.mod.vars.RData&quot;, verbose = T)
dat1 &lt;- spec.trained.data; dim(dat1); table(dat1$PA); head(dat1, 2) # examine data</code></pre>
<pre><code>## [1] 8256   38</code></pre>
<pre><code>## 
##    0    1 
## 5504 2752</code></pre>
<pre><code>##   PA elevation    slope   aspect phave phmax frag3to10 sieveno4 sieveno10
## 1  1  3044.223 5.370624 126.7778   613   780        21       76        70
## 2  1  3044.223 5.370624 126.7778   613   780        21       76        70
##   sieveno40 sieveno200 omr dryweight ksat awc wsat sand silt clay Bio1 Bio10
## 1        52         38 609       152 2822   9   31   53   26   22 0.35 10.25
## 2        52         38 609       152 2822   9   31   53   26   22 0.35 10.25
##   Bio11 Bio12 Bio13 Bio14 Bio15 Bio16 Bio17 Bio18 Bio19 Bio2 Bio3  Bio4  Bio5
## 1 -9.05 654.6  81.4  39.1  25.4 214.1   124 204.7   124 13.1 37.8 759.5 19.05
## 2 -9.05 654.6  81.4  39.1  25.4 214.1   124 204.7   124 13.1 37.8 759.5 19.05
##     Bio6 Bio7 Bio8  Bio9
## 1 -15.55 34.6 9.95 -9.05
## 2 -15.55 34.6 9.95 -9.05</code></pre>
<pre class="r"><code>dat1 &lt;- na.omit(dat1)</code></pre>
</div>
<div id="model-formula-setup" class="section level3">
<h3>Model formula setup</h3>
<pre class="r"><code># GLM Model Formula
mod.form &lt;- function(dat, r.col, p.col){
  n.col &lt;- ncol(dat) # Number of columns in the dataframe
  resp &lt;- colnames(dat[r.col]) # assign response a column name
  pred &lt;- colnames(dat[c(p.col:n.col)]) # assign preds column names
  mod.formula &lt;- as.formula(paste(resp,
                                  &quot;~&quot;, paste(pred, collapse = &quot;+&quot;))) # formula
}</code></pre>
<pre class="r"><code>names(spec.trained.data) # names of predictors</code></pre>
<pre><code>##  [1] &quot;PA&quot;         &quot;elevation&quot;  &quot;slope&quot;      &quot;aspect&quot;     &quot;phave&quot;     
##  [6] &quot;phmax&quot;      &quot;frag3to10&quot;  &quot;sieveno4&quot;   &quot;sieveno10&quot;  &quot;sieveno40&quot; 
## [11] &quot;sieveno200&quot; &quot;omr&quot;        &quot;dryweight&quot;  &quot;ksat&quot;       &quot;awc&quot;       
## [16] &quot;wsat&quot;       &quot;sand&quot;       &quot;silt&quot;       &quot;clay&quot;       &quot;Bio1&quot;      
## [21] &quot;Bio10&quot;      &quot;Bio11&quot;      &quot;Bio12&quot;      &quot;Bio13&quot;      &quot;Bio14&quot;     
## [26] &quot;Bio15&quot;      &quot;Bio16&quot;      &quot;Bio17&quot;      &quot;Bio18&quot;      &quot;Bio19&quot;     
## [31] &quot;Bio2&quot;       &quot;Bio3&quot;       &quot;Bio4&quot;       &quot;Bio5&quot;       &quot;Bio6&quot;      
## [36] &quot;Bio7&quot;       &quot;Bio8&quot;       &quot;Bio9&quot;</code></pre>
<pre class="r"><code># Basic GLM with link = Binomial, dataframe = dat1
mod1.LR &lt;- glm(as.factor(PA) ~ elevation + slope + aspect +
                 phave + phmax + frag3to10 + sieveno4 +
                 sieveno10 + sieveno40 + sieveno200 +
                 omr + dryweight + ksat + awc + wsat + sand + silt + clay +
                 Bio1 + Bio2 + Bio3 + Bio4 + Bio5 + Bio6 + Bio7 + Bio8 +
                 Bio9 + Bio10 + Bio11 + Bio12 + Bio13 + Bio14 + Bio15 + Bio16 + Bio17 +
                 Bio18 + Bio19, 
               family = binomial, data = dat1)

# save mod1.LR
#save(mod1.LR, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod1.LR.RData&quot;)

# LR model 1 summary
summary(mod1.LR)  </code></pre>
<pre><code>## 
## Call:
## glm(formula = as.factor(PA) ~ elevation + slope + aspect + phave + 
##     phmax + frag3to10 + sieveno4 + sieveno10 + sieveno40 + sieveno200 + 
##     omr + dryweight + ksat + awc + wsat + sand + silt + clay + 
##     Bio1 + Bio2 + Bio3 + Bio4 + Bio5 + Bio6 + Bio7 + Bio8 + Bio9 + 
##     Bio10 + Bio11 + Bio12 + Bio13 + Bio14 + Bio15 + Bio16 + Bio17 + 
##     Bio18 + Bio19, family = binomial, data = dat1)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6104  -0.7104  -0.2266   0.7701   2.9106  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  4.836e+01  7.749e+00   6.241 4.36e-10 ***
## elevation    1.958e-03  3.112e-04   6.291 3.15e-10 ***
## slope       -8.843e-02  1.598e-02  -5.534 3.13e-08 ***
## aspect       1.028e-03  5.292e-04   1.942 0.052109 .  
## phave       -1.375e-02  1.208e-03 -11.383  &lt; 2e-16 ***
## phmax        7.785e-04  1.006e-03   0.774 0.439089    
## frag3to10    1.979e-02  5.491e-03   3.605 0.000312 ***
## sieveno4     2.184e-02  1.836e-02   1.190 0.234212    
## sieveno10   -2.889e-02  2.399e-02  -1.204 0.228592    
## sieveno40   -1.163e-02  1.613e-02  -0.721 0.470867    
## sieveno200  -6.240e-03  1.536e-02  -0.406 0.684641    
## omr         -7.868e-05  1.994e-04  -0.395 0.693126    
## dryweight   -3.017e-03  1.161e-03  -2.599 0.009354 ** 
## ksat        -1.051e-05  5.768e-06  -1.822 0.068503 .  
## awc          4.764e-03  1.104e-02   0.432 0.665988    
## wsat         1.216e-02  4.739e-03   2.567 0.010273 *  
## sand         9.366e-02  1.131e-02   8.280  &lt; 2e-16 ***
## silt         1.161e-01  1.358e-02   8.550  &lt; 2e-16 ***
## clay         1.308e-01  1.438e-02   9.096  &lt; 2e-16 ***
## Bio1         6.502e-01  3.720e-01   1.748 0.080479 .  
## Bio2         3.585e+00  5.567e-01   6.440 1.20e-10 ***
## Bio3        -1.097e+00  2.039e-01  -5.378 7.52e-08 ***
## Bio4         3.314e-03  1.510e-02   0.219 0.826301    
## Bio5         8.986e+04  2.358e+04   3.811 0.000138 ***
## Bio6        -8.986e+04  2.358e+04  -3.811 0.000138 ***
## Bio7        -8.986e+04  2.358e+04  -3.811 0.000138 ***
## Bio8        -3.772e-02  1.272e-02  -2.965 0.003024 ** 
## Bio9        -2.654e-02  7.620e-03  -3.483 0.000495 ***
## Bio10        7.382e-01  6.951e-01   1.062 0.288249    
## Bio11        4.669e-01  5.543e-01   0.842 0.399686    
## Bio12        9.452e-03  1.909e-03   4.951 7.37e-07 ***
## Bio13        5.310e-02  1.138e-02   4.665 3.09e-06 ***
## Bio14        6.467e-02  1.747e-02   3.702 0.000214 ***
## Bio15       -8.960e-02  7.996e-03 -11.205  &lt; 2e-16 ***
## Bio16        2.267e-02  6.404e-03   3.539 0.000401 ***
## Bio17       -6.064e-02  8.022e-03  -7.560 4.04e-14 ***
## Bio18       -4.888e-02  3.870e-03 -12.630  &lt; 2e-16 ***
## Bio19       -1.904e-02  4.211e-03  -4.522 6.13e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 10507.7  on 8252  degrees of freedom
## Residual deviance:  7191.9  on 8215  degrees of freedom
## AIC: 7267.9
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="r"><code># model 1 fit
mod1.fit &lt;- 100 * (1 - mod1.LR$deviance/mod1.LR$null.deviance) # model fit
mod1.fit  # examine</code></pre>
<pre><code>## [1] 31.55593</code></pre>
<pre class="r"><code>mod1.pred &lt;- predict(mod1.LR, type = &quot;response&quot;) # model prediction

#save(mod1.pred, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod1.pred.LR.RData&quot;)

# model 1 prediction
head(mod1.pred) # examine prediction</code></pre>
<pre><code>##         1         2         3         4         5         6 
## 0.6800632 0.6800632 0.5902088 0.5902088 0.7519550 0.8730205</code></pre>
</div>
</div>
<div id="modeling-metrics" class="section level2">
<h2>Modeling Metrics</h2>
<pre class="r"><code># LR model 2; backwards stepwise variable reduction
mod2.LR &lt;- step(mod1.LR, trace = F)

# save mod2.LR
#save(mod2.LR, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.LR.RData&quot;)

# model 2 fit
100 * (1 - mod2.LR$deviance/mod2.LR$null.deviance)</code></pre>
<pre><code>## [1] 31.52939</code></pre>
<pre class="r"><code># model 1 fit
100 * (1 - mod1.LR$deviance/mod1.LR$null.deviance)</code></pre>
<pre><code>## [1] 31.55593</code></pre>
<pre class="r"><code># model 2 prediction
mod2.pred &lt;- predict(mod2.LR, type = &quot;response&quot;)

#save(mod2.pred, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.pred.LR.RData&quot;)

# examine model predictions
head(mod2.pred) # model 2</code></pre>
<pre><code>##         1         2         3         4         5         6 
## 0.6726104 0.6726104 0.5838496 0.5838496 0.7468869 0.8643118</code></pre>
<pre class="r"><code>head(mod1.pred) # model 1</code></pre>
<pre><code>##         1         2         3         4         5         6 
## 0.6800632 0.6800632 0.5902088 0.5902088 0.7519550 0.8730205</code></pre>
<pre class="r"><code># model 2 summary
summary(mod2.LR)</code></pre>
<pre><code>## 
## Call:
## glm(formula = as.factor(PA) ~ elevation + slope + aspect + phave + 
##     frag3to10 + sieveno4 + sieveno10 + dryweight + ksat + wsat + 
##     sand + silt + clay + Bio1 + Bio2 + Bio3 + Bio5 + Bio6 + Bio7 + 
##     Bio8 + Bio9 + Bio10 + Bio11 + Bio12 + Bio13 + Bio14 + Bio15 + 
##     Bio16 + Bio17 + Bio18 + Bio19, family = binomial, data = dat1)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.6388  -0.7088  -0.2256   0.7640   2.8906  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  4.795e+01  7.682e+00   6.242 4.31e-10 ***
## elevation    1.910e-03  3.042e-04   6.277 3.44e-10 ***
## slope       -9.066e-02  1.581e-02  -5.736 9.70e-09 ***
## aspect       1.089e-03  5.223e-04   2.084 0.037120 *  
## phave       -1.305e-02  9.033e-04 -14.446  &lt; 2e-16 ***
## frag3to10    2.180e-02  5.266e-03   4.140 3.48e-05 ***
## sieveno4     2.873e-02  1.695e-02   1.695 0.090131 .  
## sieveno10   -4.825e-02  1.565e-02  -3.084 0.002045 ** 
## dryweight   -3.426e-03  1.082e-03  -3.167 0.001543 ** 
## ksat        -1.090e-05  4.835e-06  -2.254 0.024165 *  
## wsat         1.445e-02  4.088e-03   3.534 0.000410 ***
## sand         9.751e-02  1.003e-02   9.722  &lt; 2e-16 ***
## silt         1.110e-01  1.115e-02   9.950  &lt; 2e-16 ***
## clay         1.256e-01  1.201e-02  10.464  &lt; 2e-16 ***
## Bio1         5.770e-01  3.509e-01   1.644 0.100112    
## Bio2         3.535e+00  5.507e-01   6.419 1.37e-10 ***
## Bio3        -1.072e+00  2.014e-01  -5.323 1.02e-07 ***
## Bio5         9.156e+04  2.347e+04   3.902 9.54e-05 ***
## Bio6        -9.156e+04  2.347e+04  -3.902 9.54e-05 ***
## Bio7        -9.156e+04  2.347e+04  -3.902 9.54e-05 ***
## Bio8        -3.744e-02  1.270e-02  -2.948 0.003194 ** 
## Bio9        -2.617e-02  7.458e-03  -3.508 0.000451 ***
## Bio10        9.175e-01  2.780e-01   3.300 0.000965 ***
## Bio11        3.866e-01  2.294e-01   1.685 0.091975 .  
## Bio12        9.711e-03  1.894e-03   5.127 2.95e-07 ***
## Bio13        5.239e-02  1.094e-02   4.790 1.67e-06 ***
## Bio14        6.673e-02  1.734e-02   3.849 0.000119 ***
## Bio15       -8.841e-02  7.771e-03 -11.377  &lt; 2e-16 ***
## Bio16        2.170e-02  6.251e-03   3.471 0.000518 ***
## Bio17       -6.162e-02  7.961e-03  -7.741 9.88e-15 ***
## Bio18       -4.832e-02  3.754e-03 -12.873  &lt; 2e-16 ***
## Bio19       -1.867e-02  4.191e-03  -4.454 8.43e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 10507.7  on 8252  degrees of freedom
## Residual deviance:  7194.7  on 8221  degrees of freedom
## AIC: 7258.7
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="r"><code># add var to keep track of model
modl &lt;- &quot;mod2.LR&quot;
dat2 &lt;- cbind(modl, dat1[1], mod2.pred) # build prediction df with mod2 preds

# Create confusion matrix
mod.cut &lt;- optimal.thresholds(dat2, opt.methods = c(&quot;MaxKappa&quot;))
mod2.cfmat &lt;- table(dat2[[2]],
                    factor(as.numeric(dat2$mod2.pred &gt;= mod.cut$mod2.pred)))
mod2.cfmat # examine confusion matrix</code></pre>
<pre><code>##    
##        0    1
##   0 4230 1271
##   1  544 2208</code></pre>
<pre class="r"><code>#save(mod.cut, file = &quot;F:/Josh/Plants/spp/   Mods/Mod.LR/mod.cut.LR.RData&quot;) # save mod.cut
#save(mod2.cfmat, file = &quot;F:/Josh/Plants/spp/   Mods/Mod.LR/mod2.cfmat.LR.RData&quot;)

# Model accuracies 
mod2.acc &lt;- presence.absence.accuracy(dat2, 
                                      threshold = mod.cut$mod2.pred,
                                      st.dev = F)
tss &lt;- mod2.acc$sensitivity + mod2.acc$specificity - 1 
mod2.acc &lt;- cbind(mod2.acc[1:7], tss) # bind metrics
mod2.acc[c(1, 4:5, 7:8)] # examine accuracies</code></pre>
<pre><code>##       model sensitivity specificity       AUC       tss
## 1 mod2.pred   0.8023256   0.7689511 0.8574226 0.5712767</code></pre>
<pre class="r"><code>#save(mod2.acc, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.acc.LR.RData&quot;)

#windows(22,12)
auc.roc.plot(dat2, color = T)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>#savePlot(&quot;auc.roc.plot.LR.jpeg&quot;, type = &quot;jpeg&quot;)
#dev.off()

# Cross validation accuracies
mod2.cv10 &lt;- CVbinary(mod2.LR, nfolds = 5, print.details = F) # crossval
ls(mod2.cv10)</code></pre>
<pre><code>## [1] &quot;acc.cv&quot;       &quot;acc.internal&quot; &quot;acc.training&quot; &quot;cvhat&quot;        &quot;internal&quot;    
## [6] &quot;training&quot;</code></pre>
<pre class="r"><code>mod2.cv10.1 &lt;- mod2.cv10$cvhat

#save(mod2.cv10, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.cv10.RData&quot;)

dat2 &lt;- cbind(dat2, mod2.cv10.1)
head(dat2)</code></pre>
<pre><code>##      modl PA mod2.pred mod2.cv10.1
## 1 mod2.LR  1 0.6726104   0.6560960
## 2 mod2.LR  1 0.6726104   0.6515394
## 3 mod2.LR  1 0.5838496   0.5672087
## 4 mod2.LR  1 0.5838496   0.6103093
## 5 mod2.LR  1 0.7468869   0.7508339
## 6 mod2.LR  1 0.8643118   0.8533845</code></pre>
<pre class="r"><code>#save(dat2, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod.predictionframe.RData&quot;)

# model CVbinary
mod2.cfmatCV &lt;- table(dat2[[2]], 
                      factor(as.numeric(dat2$mod2.cv10.1 &gt;= mod.cut$mod2.pred)))
# examine both mod confusion matrices
mod2.cfmatCV; mod2.cfmat</code></pre>
<pre><code>##    
##        0    1
##   0 4213 1288
##   1  596 2156</code></pre>
<pre><code>##    
##        0    1
##   0 4230 1271
##   1  544 2208</code></pre>
<pre class="r"><code>#save(mod2.cfmatCV, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.cfmatCV.RData&quot;)

# calculate accuracies with std.dev = F
mod2.accB &lt;- presence.absence.accuracy(dat2, 
                                       threshold = mod.cut$mod2.pred, 
                                       st.dev = F)
tss &lt;- mod2.accB$sensitivity + mod2.accB$specificity - 1 # code TSS metric
mod2.accB &lt;- cbind(mod2.accB[1:7], tss) # bind all metrics
mod2.accB[c(1, 4:5, 7:8)] # examine accuracies</code></pre>
<pre><code>##         model sensitivity specificity       AUC       tss
## 1   mod2.pred   0.8023256   0.7689511 0.8574226 0.5712767
## 2 mod2.cv10.1   0.7834302   0.7658608 0.8535553 0.5492910</code></pre>
<pre class="r"><code>#save(mod2.accB, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.accB.RData&quot;)</code></pre>
<pre class="r"><code>#save(mod2.acc, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.acc.LR.RData&quot;)


auc.roc.plot(dat2, color = T)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>#savePlot(&quot;auc.roc.plot.LR.jpeg&quot;, type = &quot;jpeg&quot;)
dev.off()</code></pre>
<pre><code>## null device 
##           1</code></pre>
<pre class="r"><code># Cross validation accuracies
mod2.cv10 &lt;- CVbinary(mod2.LR, nfolds = 5, print.details = F) # crossval
ls(mod2.cv10)</code></pre>
<pre><code>## [1] &quot;acc.cv&quot;       &quot;acc.internal&quot; &quot;acc.training&quot; &quot;cvhat&quot;        &quot;internal&quot;    
## [6] &quot;training&quot;</code></pre>
<pre class="r"><code>mod2.cv10.1 &lt;- mod2.cv10$cvhat

#save(mod2.cv10, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.cv10.RData&quot;)

dat2 &lt;- cbind(dat2, mod2.cv10.1)
head(dat2)</code></pre>
<pre><code>##      modl PA mod2.pred mod2.cv10.1 mod2.cv10.1
## 1 mod2.LR  1 0.6726104   0.6560960   0.6635340
## 2 mod2.LR  1 0.6726104   0.6515394   0.6635340
## 3 mod2.LR  1 0.5838496   0.5672087   0.6049995
## 4 mod2.LR  1 0.5838496   0.6103093   0.5684916
## 5 mod2.LR  1 0.7468869   0.7508339   0.7382543
## 6 mod2.LR  1 0.8643118   0.8533845   0.8485746</code></pre>
<pre class="r"><code>#save(dat2, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod.predictionframe.RData&quot;)

# model CVbinary
mod2.cfmatCV &lt;- table(dat2[[2]], 
                      factor(as.numeric(dat2$mod2.cv10.1 &gt;= mod.cut$mod2.pred)))
# examine both mod confusion matrices
mod2.cfmatCV; mod2.cfmat</code></pre>
<pre><code>##    
##        0    1
##   0 4213 1288
##   1  596 2156</code></pre>
<pre><code>##    
##        0    1
##   0 4230 1271
##   1  544 2208</code></pre>
<pre class="r"><code>#save(mod2.cfmatCV, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.cfmatCV.RData&quot;)</code></pre>
<pre class="r"><code># calculate accuracies with std.dev = F
mod2.accB &lt;- presence.absence.accuracy(dat2, 
                                       threshold = mod.cut$mod2.pred, 
                                       st.dev = F)
tss &lt;- mod2.accB$sensitivity + mod2.accB$specificity - 1 # code TSS metric
mod2.accB &lt;- cbind(mod2.accB[1:7], tss) # bind all metrics
mod2.accB[c(1, 4:5, 7:8)] # examine accuracies</code></pre>
<pre><code>##           model sensitivity specificity       AUC       tss
## 1     mod2.pred   0.8023256   0.7689511 0.8574226 0.5712767
## 2   mod2.cv10.1   0.7834302   0.7658608 0.8535553 0.5492910
## 3 mod2.cv10.1.1   0.7856105   0.7665879 0.8539678 0.5521984</code></pre>
<pre class="r"><code>#save(mod2.accB, file = &quot;F:/Josh/Plants/spp/Mods/Mod.LR/mod2.accB.RData&quot;)</code></pre>
<pre class="r"><code># view both cfmats in same AUC plot
#windows(22,12)
auc.roc.plot(dat2, color = T)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<pre class="r"><code>#savePlot(&quot;auc.roc.plot.LR.BOTH.jpeg&quot;, type = &quot;jpeg&quot;)</code></pre>
</div>
<div id="modeling-ouputs" class="section level2">
<h2>Modeling Ouputs</h2>
<div id="probability-model" class="section level3">
<h3>Probability Model</h3>
<pre class="r"><code># spatial probability prediction
spp.predsR &lt;- as(preds, &quot;Raster&quot;)
modFprob.LR.1 &lt;- predict(spp.predsR, mod1.LR, filename = &quot;mod2.LRprob.tif&quot;, 
                         type = &quot;response&quot;, fun = predict, 
                         index = 2, overwrite = T)</code></pre>
</div>
<div id="classified-on-model-threshold" class="section level3">
<h3>CLassified on Model Threshold</h3>
<pre class="r"><code># classified prediction
modFprobclas.R=reclassify(modFprob.LR.1,c(0,mod.cut[[2]],0,mod.cut[[2]],1,1))</code></pre>
</div>
<div id="classified-model-probability" class="section level3">
<h3>Classified Model Probability</h3>
<pre class="r"><code>modFprobclas.bin.R &lt;- reclassify(modFprob.LR.1,c(0,.2,1,
                                                 .2,.4,2,
                                                 .4,.6,3,
                                                 .6,.8,4,
                                                 0.8,1,5))</code></pre>
</div>
</div>
<div id="plot" class="section level2">
<h2>Plot</h2>
<pre class="r"><code>plot(modFprob.LR.1, main = &quot;Probability Model&quot;)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre class="r"><code>plot(modFprobclas.R, main = &quot;Threshold Classification&quot;)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
<pre class="r"><code>plot(modFprobclas.bin.R, main = &quot;Binned Probability&quot;)</code></pre>
<p><img src="Species_Distribution_Modeling_files/figure-html/unnamed-chunk-28-3.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
